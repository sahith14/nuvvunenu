<!DOCTYPE html>
<html>
<head>
  <title>Set Up Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
</head>

<body class="auth-body">

  <div class="auth-card glass">
    <h2>Complete Your Profile ðŸ’œ</h2>

    <input id="setup-username" placeholder="Choose a username">
    <input id="setup-name" placeholder="Your full name">

    <button onclick="saveUserInfo()">Save</button>
  </div>

  <script type="module">
    import { auth, db } from "./firebase.js";
    import { doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // USERNAME â†’ SEARCH KEYWORD GENERATOR
    function generateKeywords(name) {
      name = name.toLowerCase();
      const arr = [];
      let cur = "";
      for (let c of name) {
        cur += c;
        arr.push(cur);
      }
      return arr;
    }

    window.saveUserInfo = async function () {
      const username = document.getElementById("setup-username").value.trim();
      const name = document.getElementById("setup-name").value.trim();

      if (!username || !name) {
        alert("Please fill all fields");
        return;
      }

      const uid = auth.currentUser.uid;
      const ref = doc(db, "users", uid);

      await setDoc(ref, {
        uid,
        username,
        name,
        searchKeywords: generateKeywords(username),
        createdAt: Date.now(),
        following: [],
        followers: [],
        avatar: `https://i.pravatar.cc/150?u=${uid}`
      }, { merge: true });

      window.location.href = "app.html";
    };
  </script>

</body>
</html>
